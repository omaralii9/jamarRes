<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>منيو جَمَار — Jamar Menu</title>

  <!-- خطوط -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --orange:#FF7A00;
      --maroon:#800020;
      --beige:#F5E6D3;
      --text:#3a2f2f;
      --muted:#7a6a63;
      --card-radius:14px;
      --max-width:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0;background:linear-gradient(180deg,#fff,var(--beige));font-family:"Cairo",sans-serif;color:var(--text)}
    .container{max-width:var(--max-width);margin:24px auto;padding:0 18px;}
    .wrap{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 12px 30px rgba(0,0,0,0.08)}
    header{display:flex;align-items:center;justify-content:space-between;padding:20px 22px;background:linear-gradient(90deg,var(--maroon),#5b0d11);color:#fff}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,var(--orange),#ff6a00);display:flex;align-items:center;justify-content:center;font-family:"Playfair Display",serif;font-weight:700;font-size:22px;color:#fff;box-shadow:0 8px 22px rgba(0,0,0,0.15)}
    .brand .name{font-family:"Playfair Display",serif;font-size:20px}
    .brand .sub{font-size:12px;opacity:0.95}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn{background:var(--orange);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.18);color:#fff}
    .hero{padding:26px 28px;display:flex;gap:18px;align-items:center}
    .hero .intro{flex:1}
    .hero h1{margin:0;font-family:"Playfair Display",serif;color:var(--maroon);font-size:28px}
    .hero p{margin:6px 0 0;color:var(--muted)}

    /* sections grid */
    .sections{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding:18px}
    .card{background:linear-gradient(180deg,#fff,#fff9f2);padding:18px;border-radius:12px;border:1px solid rgba(0,0,0,0.03);cursor:pointer;display:flex;flex-direction:column;gap:10px;align-items:flex-end;min-height:120px;transition:transform .18s,box-shadow .18s}
    .card:hover{transform:translateY(-6px);box-shadow:0 14px 30px rgba(0,0,0,0.08)}
    .card .icon{width:64px;height:64px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--maroon);background:rgba(128,0,32,0.05);font-size:14px;border:1px dashed rgba(0,0,0,0.04)}
    .card .title{font-weight:700;color:var(--maroon);font-size:16px}
    .card .subtitle{font-size:12px;color:var(--muted)}
    .card small{color:var(--muted);align-self:flex-start}

    /* responsive */
    @media (max-width:980px){.sections{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.sections{grid-template-columns:1fr}.hero{flex-direction:column;align-items:flex-start}}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:1200}
    .modal{background:#fff;width:100%;max-width:720px;border-radius:12px;padding:18px;box-shadow:0 20px 50px rgba(0,0,0,0.3);max-height:90vh;overflow:auto}
    .modal header{display:flex;align-items:center;justify-content:space-between;padding:0;margin-bottom:8px;background:transparent;color:var(--maroon)}
    .modal h3{margin:0;font-family:"Playfair Display",serif}
    .items{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);background:linear-gradient(180deg,#fff,#fffef8)}
    .item .thumb{width:82px;height:62px;border-radius:8px;overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:var(--maroon);font-weight:700;background:rgba(128,0,32,0.05);font-size:14px;border:1px dashed rgba(0,0,0,0.04)}
    .item .thumb img{width:100%;height:100%;object-fit:cover;}
    .item .meta{flex:1;display:flex;flex-direction:column;gap:6px}
    .item .meta .name{font-weight:700;color:var(--text);display:flex;justify-content:space-between;align-items:center}
    .item .meta .desc{font-size:13px;color:var(--muted)}
    .item .meta .price{font-weight:800;color:var(--orange)}
    .item .actions{display:flex;flex-direction:column;gap:8px}
    .qty-input{width:64px;padding:6px;border-radius:8px;border:1px solid #e2d6d3;text-align:center}
    .add-cart{background:var(--maroon);color:#fff;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
    .remove-btn{background:#f3f3f3;border:1px solid #eee;padding:6px;border-radius:6px;cursor:pointer}

    .modal .section-order{display:flex;gap:10px;align-items:center;margin-top:12px}
    .close-x{background:transparent;border:0;font-weight:700;color:var(--muted);cursor:pointer}

    footer{padding:12px 18px;background:#fff;border-top:1px solid rgba(0,0,0,0.04);display:flex;justify-content:space-between;align-items:center}
    .contact{color:var(--muted);font-size:13px}
    .qr img{width:64px;height:64px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}
    .note{font-size:12px;color:var(--muted);padding:10px 18px}

    /* cart floating button */
    .cart-btn {
      position: fixed;
      bottom: 24px;
      left: 24px;
      background: var(--maroon);
      color: #fff;
      border: none;
      padding: 12px 16px;
      border-radius: 12px;
      z-index: 1500;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      font-weight:700;
    }

    .cart-list{display:flex;flex-direction:column;gap:8px}
    .cart-row{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:8px;border-radius:8px;border:1px solid #f0e9e6}
    .cart-row .name{flex:1}
    .cart-row .controls{display:flex;gap:6px;align-items:center}
    .summary-line{display:flex;justify-content:space-between;padding-top:8px;border-top:1px solid #eee;margin-top:8px}
    .send-btn{background:var(--orange);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:800;margin-top:10px;width:100%}
    .small-ghost{background:transparent;border:1px solid var(--maroon);color:var(--maroon);padding:6px 8px;border-radius:8px;cursor:pointer;font-weight:700}
    .radio-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .muted-small{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo">J</div>
          <div>
            <div class="name">جَمَار — Jamar</div>
            <div class="sub">Classic & Comfort — المذاق الإيطالي الدافئ</div>
          </div>
        </div>

        <div class="header-actions">
          <button id="orderNowTop" class="btn" title="اطلب عبر واتساب">اطلب الآن</button>
          <button id="openQR" class="btn ghost">QR</button>
        </div>
      </header>

      <div class="hero">
        <div class="intro">
          <h1>قائمة الأقسام — Sections</h1>
          <p>اختر قسمًا لعرض الأصناف. يمكنك إضافة المنتجات إلى السلة ثم إتمام الطلب.</p>
        </div>
      </div>

      <div class="sections" id="sections">
        <!-- البطاقات موجودة سابقاً — نستخدمها للفتح -->
        <div class="card" data-section="burgers" onclick="openSection('burgers')">
          <div class="icon">برجر</div>
          <div class="title">Burgers — برجر</div>
          <small>اللحوم، الدجاج، كلاسيك ومكسيكان</small>
        </div>

        <div class="card" data-section="wings" onclick="openSection('wings')">
          <div class="icon">أجنحة</div>
          <div class="title">Wings — أجنحة</div>
          <small>مقلية، مشوية ونكهات متنوعة</small>
        </div>

        <div class="card" data-section="salads" onclick="openSection('salads')">
          <div class="icon">سلطات</div>
          <div class="title">Salads — سلطات</div>
          <small>تبولة، فتوش، سيزر</small>
        </div>

        <div class="card" data-section="rolls" onclick="openSection('rolls')">
          <div class="icon">رولز</div>
          <div class="title">Rolls — رولز</div>
          <small>كرسبي، كباب، جمار رولز</small>
        </div>

        <div class="card" data-section="tacos" onclick="openSection('tacos')">
          <div class="icon">تاكوز</div>
          <div class="title">Tacos — تاكوز</div>
          <small>كرسبي، فيلادلفيا، جمار</small>
        </div>

        <div class="card" data-section="snacks" onclick="openSection('snacks')">
          <div class="icon">تسالي</div>
          <div class="title">Snacks — تسالي</div>
          <small>ناجتس، موتزريلا، ويدجز</small>
        </div>

        <div class="card" data-section="healthy" onclick="openSection('healthy')">
          <div class="icon">صحي</div>
          <div class="title">Healthy — وجبات صحية</div>
          <small>دجاج مشوي، كباب</small>
        </div>

        <div class="card" data-section="boxes" onclick="openSection('boxes')">
          <div class="icon">بوكس</div>
          <div class="title">Boxes — بكيجات</div>
          <small>بوكس عائلي، هابي، فريندز</small>
        </div>

        <div class="card" data-section="drinks" onclick="openSection('drinks')">
          <div class="icon">مشروبات</div>
          <div class="title">Drinks — مشروبات</div>
          <small>عصائر، كولا، ماء</small>
        </div>
      </div>

      <p class="note">محتوى الأطباق مأخوذ من ملف المنيو الذي أرسلته.</p>

      <footer>
        <div class="contact">اتصل بنا: 0599-888358 — التوصيل متاح</div>
        <div class="qr">
          <img id="qrImg" alt="QR" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://example.com/your-menu" />
        </div>
      </footer>
    </div>
  </div>

  <!-- زر السلة العائم -->
  <button class="cart-btn" id="openCartBtn">السلة 🛒 (0)</button>

  <!-- Modal عرض القسم واصناف + زر إضافة للسلة -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-modal="true">
      <header>
        <div>
          <h3 id="modalTitle">قسم</h3>
          <div id="modalDesc" style="color:var(--muted);font-size:13px;margin-top:6px"></div>
        </div>
        <div>
          <button class="close-x" id="closeModalBtn">✕ إغلاق</button>
        </div>
      </header>

      <div id="modalItems" class="items"></div>

      <div class="section-order" style="justify-content:flex-end;margin-top:12px;">
        <button id="orderSectionBtn" class="add-cart">اطلب من هذا القسم عبر واتساب</button>
        <button class="small-ghost" onclick="print()">طباعة / حفظ PDF</button>
      </div>
    </div>
  </div>

  <!-- Modal السلة -->
  <div class="modal-backdrop" id="cartBackdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-modal="true" style="max-width:640px">
      <header>
        <div>
          <h3 id="cartTitle">سلة الطلب</h3>
          <div class="muted-small" id="cartCountText">لا توجد أصناف</div>
        </div>
        <div>
          <button class="close-x" id="closeCartBtn">✕ إغلاق</button>
        </div>
      </header>

      <div id="cartList" class="cart-list"></div>

      <div class="summary-line">
        <div>المجموع الفرعي</div>
        <div id="subtotal">0 ₪</div>
      </div>

      <div style="margin-top:12px">
        <button class="send-btn" id="checkoutBtn">إتمام الطلب</button>
        <button class="small-ghost" id="clearCartBtn" style="width:100%;margin-top:8px">تفريغ السلة</button>
      </div>
    </div>
  </div>

  <!-- Modal اختيار نوع الطلب -->
  <div class="modal-backdrop" id="orderTypeBackdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-modal="true" style="max-width:520px">
      <header>
        <div>
          <h3 id="orderTypeTitle">تفاصيل الطلب</h3>
          <div class="muted-small">اختر نوع الطلب ومكان التوصيل إن وجد</div>
        </div>
        <div>
          <button class="close-x" id="closeOrderTypeBtn">✕ إغلاق</button>
        </div>
      </header>

      <form id="orderForm" style="display:flex;flex-direction:column;gap:12px">
        <div>
          <div style="font-weight:800;color:var(--maroon);margin-bottom:6px">نوع الطلب</div>
          <div class="radio-row">
            <label><input type="radio" name="orderType" value="inside" checked> طلب داخل المطعم</label>
            <label><input type="radio" name="orderType" value="outside"> توصيل خارجي</label>
          </div>
        </div>

        <div id="citySection" style="display:none">
          <div style="font-weight:800;color:var(--maroon);margin-bottom:6px">اختر المدينة للتوصيل</div>
          <div class="radio-row">
            <label><input type="radio" name="city" value="tulkarm"> طولكرم (+10 ₪)</label>
            <label><input type="radio" name="city" value="nablus"> نابلس (+20 ₪)</label>
            <label><input type="radio" name="city" value="other"> أخرى (0 ₪)</label>
          </div>
        </div>

        <div class="summary-line">
          <div>الإجمالي الحالي</div>
          <div id="orderTotal">0 ₪</div>
        </div>

        <div>
          <label style="font-weight:700;margin-bottom:6px">ملاحظات (اختياري)</label>
          <textarea id="orderNotes" rows="3" style="width:100%;padding:8px;border-radius:8px;border:1px solid #eee"></textarea>
        </div>

        <div style="display:flex;gap:10px">
          <button type="submit" class="send-btn" style="flex:1">أرسل الطلب عبر واتساب</button>
          <button type="button" class="small-ghost" id="backToCartBtn" style="flex:1">العودة للسلة</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ====== إعداد رقم الواتساب والرسائل ======
    const WA_NUMBER = '972599888358';
    const BASE_WA_URL = 'https://wa.me/' + WA_NUMBER + '?text=';

    function makeWaLink(message){
      return BASE_WA_URL + encodeURIComponent(message);
    }

    // ====== القائمة (مضاف لها أسعار وهمية) ======
    const MENU = {
      burgers: {
        title: 'Burgers — برجر',
        desc: 'أحجام مختلفة متوفرة: 100gm -160gm -200gm -320gm -400gm',
        items:[
          {name:'Beef Burger — بيف برجر', price:30, desc:'خيار كلاسيكي لحم طازج مع صلصات مميزة.', img:'https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=400&q=60'},
          {name:'Mexican Burger — مكسيكان برجر', price:38, desc:'سبايسي ميونيز، شيدر، جواكامولي.', img:'https://images.unsplash.com/photo-1600891964599-f61ba0e24092?auto=format&fit=crop&w=400&q=60'},
          {name:'Classic Burger — كلاسيك برجر', price:28, desc:'مكونات طازجة ونكهة تقليدية.', img:'https://images.unsplash.com/photo-1550317138-10000687a72b?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      wings: {
        title:'Wings — أجنحة',
        desc:'وجبات أجنحة بمذاقات متنوعة — متوفرة كقطع أو بالوزن.',
        items:[
          {name:'Buffelo Wings — أجنحة بآفلو', price:35, desc:'أجنحة مقلية بطعم البافلو', img:'https://images.unsplash.com/photo-1613101045231-30a217b1b2d2?auto=format&fit=crop&w=400&q=60'},
          {name:'BBQ Wings — أجنحة باربكيو', price:36, desc:'نكهة باربيكيو مدخنة لذيذة.', img:'https://images.unsplash.com/photo-1543352634-9f0b57bbd785?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      salads:{
        title:'Salads — سلطات',
        desc:'سلطات طازجة متنوعة.',
        items:[
          {name:'Tabbouleh — تبولة', price:18, desc:'تبولة فلسطينية مع نعناع وبقدونس.', img:'https://images.unsplash.com/photo-1573777036300-16db7a3d92bb?auto=format&fit=crop&w=400&q=60'},
          {name:'Fattoush — فتوش', price:20, desc:'سلطة عربية بالخبز المحمص وخضروات.', img:'https://images.unsplash.com/photo-1553621042-f6e147245754?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      rolls:{
        title:'Rolls — رولز',
        desc:'رولز متنوعة من كرسبي وكباب.',
        items:[
          {name:'Crispy Roll — رول كرسبي', price:32, desc:'دجاج كرسبي مع صوص خاص.', img:'https://images.unsplash.com/photo-1617191517593-953330932f55?auto=format&fit=crop&w=400&q=60'},
          {name:'Kebab Roll — رول كباب', price:30, desc:'لحم كباب متبل مع خضار.', img:'https://images.unsplash.com/photo-1542831371-d531d36971e6?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      tacos:{
        title:'Tacos — تاكوز',
        desc:'تاكوز بنكهات متعددة.',
        items:[
          {name:'Crispy Taco — تاكو كرسبي', price:28, desc:'دجاج مقلي، خس، جبنة، صوص.', img:'https://images.unsplash.com/photo-1600891964599-f61ba0e24092?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      snacks:{
        title:'Snacks — تسالي',
        desc:'تسالي وبطاطا وناجتس.',
        items:[
          {name:'Nuggets — ناجتس', price:22, desc:'قطع دجاج مقرمشة.', img:'https://images.unsplash.com/photo-1604908177520-c47db43e3ae4?auto=format&fit=crop&w=400&q=60'},
          {name:'Potato Wedges — ويدجز', price:24, desc:'بطاطا ويدجز متبلة.', img:'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      healthy:{
        title:'Healthy — وجبات صحية',
        desc:'خيار صحي وخفيف.',
        items:[
          {name:'Grilled Chicken — دجاج مشوي', price:36, desc:'صدور دجاج مشوية مع خضار.', img:'https://images.unsplash.com/photo-1568605114967-8130f3a36994?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      boxes:{
        title:'Boxes — بكيجات',
        desc:'بكيجات عائلية.',
        items:[
          {name:'Family Box — بوكس عائلي', price:150, desc:'بوكس عائلي متكامل.', img:'https://images.unsplash.com/photo-1543352634-9f0b57bbd785?auto=format&fit=crop&w=400&q=60'}
        ]
      },
      drinks:{
        title:'Drinks — مشروبات',
        desc:'عصائر ومشروبات غازية وماء.',
        items:[
          {name:'Cola — كولا', price:8, desc:'مشروب غازي بارد.', img:'https://images.unsplash.com/photo-1551024709-8f23befc6e5f?auto=format&fit=crop&w=400&q=60'},
          {name:'Water — ماء', price:5, desc:'ماء معدني بارد.', img:'https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=400&q=60'}
        ]
      }
    };

    // ====== عناصر DOM ======
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalItems = document.getElementById('modalItems');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const orderSectionBtnEl = document.getElementById('orderSectionBtn');

    const openCartBtn = document.getElementById('openCartBtn');
    const cartBackdrop = document.getElementById('cartBackdrop');
    const cartList = document.getElementById('cartList');
    const closeCartBtn = document.getElementById('closeCartBtn');
    const subtotalEl = document.getElementById('subtotal');
    const cartCountBtn = document.getElementById('openCartBtn');

    const checkoutBtn = document.getElementById('checkoutBtn');
    const clearCartBtn = document.getElementById('clearCartBtn');

    const orderTypeBackdrop = document.getElementById('orderTypeBackdrop');
    const closeOrderTypeBtn = document.getElementById('closeOrderTypeBtn');
    const orderForm = document.getElementById('orderForm');
    const citySection = document.getElementById('citySection');
    const orderTotalEl = document.getElementById('orderTotal');
    const backToCartBtn = document.getElementById('backToCartBtn');
    const orderNotes = document.getElementById('orderNotes');

    // السلة كـ مصفوفة
    let cart = [];

    // تحديث زر السلة بعدد العناصر
    function updateCartButton(){
      const count = cart.reduce((s,i)=>s+i.qty,0);
      cartCountBtn.textContent = `السلة 🛒 (${count})`;
      document.getElementById('cartCountText').textContent = count ? `${count} صنف` : 'لا توجد أصناف';
    }

    // فتح قسم وعرض الأصناف
    function openSection(sectionKey){
      const section = MENU[sectionKey];
      if(!section) return;
      modalTitle.textContent = section.title;
      modalDesc.textContent = section.desc || '';
      modalItems.innerHTML = '';

      section.items.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="thumb"><img src="${item.img}" alt="${item.name}"></div>
          <div class="meta">
            <div class="name">${item.name} <span class="price">${item.price} ₪</span></div>
            <div class="desc">${item.desc || ''}</div>
          </div>
          <div class="actions">
            <div style="display:flex;gap:8px;align-items:center">
              <input type="number" min="1" value="1" id="qty_${sectionKey}_${idx}" class="qty-input" />
              <button class="add-cart" data-section="${sectionKey}" data-index="${idx}">أضف إلى السلة</button>
            </div>
            <div style="margin-top:6px;display:flex;gap:6px">
              <button class="small-ghost" onclick="orderItem('${escapeJs(item.name)}','${escapeJs(section.title)}')">اطلب هذا الصنف</button>
              <button class="small-ghost" onclick="quickOrder('${escapeJs(item.name)}')">طلب سريع</button>
            </div>
          </div>
        `;
        modalItems.appendChild(div);
      });

      // زر طلب القسم الكامل
      orderSectionBtnEl.onclick = () => {
        const message = `مرحبًا، أود الطلب من قسم ${section.title}`;
        window.open(makeWaLink(message), '_blank');
      };

      modalBackdrop.style.display = 'flex';
      modalBackdrop.setAttribute('aria-hidden','false');
    }

    // إغلاق مودال القسم
    closeModalBtn.addEventListener('click', closeModal);
    function closeModal(){
      modalBackdrop.style.display = 'none';
      modalBackdrop.setAttribute('aria-hidden','true');
      modalItems.innerHTML = '';
    }
    modalBackdrop.addEventListener('click',(e)=>{ if(e.target===modalBackdrop) closeModal(); });

    // استمع لأزرار "أضف إلى السلة" داخل المودال (delegation)
    modalItems.addEventListener('click', (e)=>{
      const btn = e.target.closest('.add-cart');
      if(!btn) return;
      const sectionKey = btn.dataset.section;
      const index = +btn.dataset.index;
      const qtyInput = document.getElementById(`qty_${sectionKey}_${index}`);
      let qty = parseInt(qtyInput.value);
      if(isNaN(qty) || qty < 1) qty = 1;
      const item = MENU[sectionKey].items[index];
      addToCart(item, qty);
      // feedback
      btn.textContent = 'تمت الإضافة ✓';
      setTimeout(()=> btn.textContent = 'أضف إلى السلة', 900);
    });

    // هروب النص ليكون صالح للـ onclick strings
    function escapeJs(text){
      return text.replace(/'/g,"\\'").replace(/"/g,'\\"');
    }

    // طلب صنف واحد — يفتح واتساب مباشرة
    function orderItem(itemName, sectionTitle){
      const message = `مرحبًا، أود طلب الصنف "${itemName}" من قسم ${sectionTitle}`;
      window.open(makeWaLink(message), '_blank');
    }
    function quickOrder(itemName){
      const message = `مرحبًا، أود طلب الصنف "${itemName}"`;
      window.open(makeWaLink(message), '_blank');
    }

    // اضافة للسلة
    function addToCart(item, qty){
      // تحقق هل المنتج موجود
      const found = cart.find(ci => ci.name === item.name);
      if(found){
        found.qty += qty;
      } else {
        cart.push({name: item.name, price: item.price, qty: qty});
      }
      renderCart();
      updateCartButton();
    }

    // فتح السلة
    document.getElementById('openCartBtn').addEventListener('click', () => {
      renderCart();
      cartBackdrop.style.display = 'flex';
      cartBackdrop.setAttribute('aria-hidden','false');
    });

    // اغلاق السلة
    closeCartBtn.addEventListener('click', closeCart);
    function closeCart(){
      cartBackdrop.style.display = 'none';
      cartBackdrop.setAttribute('aria-hidden','true');
    }
    cartBackdrop.addEventListener('click', (e)=> { if(e.target===cartBackdrop) closeCart(); });

    // تفريغ السلة
    clearCartBtn.addEventListener('click', ()=>{
      if(!confirm('هل تريد تفريغ السلة؟')) return;
      cart = [];
      renderCart();
      updateCartButton();
      closeCart();
    });

    // عرض عناصر السلة
    function renderCart(){
      cartList.innerHTML = '';
      if(cart.length === 0){
        cartList.innerHTML = '<div class="muted-small">السلة فارغة</div>';
        subtotalEl.textContent = '0 ₪';
        updateCartButton();
        return;
      }
      let subtotal = 0;
      cart.forEach((ci, idx) => {
        const row = document.createElement('div');
        row.className = 'cart-row';
        const itemTotal = ci.price * ci.qty;
        subtotal += itemTotal;
        row.innerHTML = `
          <div class="name"><strong>${ci.name}</strong><div class="muted-small">${ci.price} ₪ لكل وحدة</div></div>
          <div class="controls">
            <button class="remove-btn" data-idx="${idx}" title="حذف">✕</button>
            <button class="small-ghost" data-inc="${idx}" data-delta="-1">-</button>
            <div style="padding:6px 8px;border-radius:6px;background:#f8f5f3">${ci.qty}</div>
            <button class="small-ghost" data-inc="${idx}" data-delta="1">+</button>
            <div style="min-width:70px;text-align:right">${itemTotal} ₪</div>
          </div>
        `;
        cartList.appendChild(row);
      });
      subtotalEl.textContent = `${subtotal} ₪`;
      updateCartButton();
    }

    // حذف أو تعديل كمية داخل السلة (delegation)
    cartList.addEventListener('click', (e)=>{
      const rem = e.target.closest('.remove-btn');
      if(rem){
        const idx = +rem.dataset.idx;
        cart.splice(idx,1);
        renderCart();
        updateCartButton();
        return;
      }
      const inc = e.target.closest('[data-inc]');
      if(inc){
        const idx = +inc.dataset.inc;
        const delta = parseInt(inc.dataset.delta,10);
        cart[idx].qty += delta;
        if(cart[idx].qty <= 0) cart.splice(idx,1);
        renderCart();
        updateCartButton();
      }
    });

    // إتمام الطلب -> فتح نافذة اختيار النوع
    checkoutBtn.addEventListener('click', ()=>{
      if(cart.length === 0){
        alert('السلة فارغة، رجاء أضف أصنافاً قبل إتمام الطلب.');
        return;
      }
      // حساب وعرض إجمالي ابتدائي
      updateOrderTotal();
      cartBackdrop.style.display = 'none';
      orderTypeBackdrop.style.display = 'flex';
      orderTypeBackdrop.setAttribute('aria-hidden','false');
    });

    // إغلاق مودال اختيار النوع
    closeOrderTypeBtn.addEventListener('click', closeOrderType);
    function closeOrderType(){
      orderTypeBackdrop.style.display = 'none';
      orderTypeBackdrop.setAttribute('aria-hidden','true');
    }
    orderTypeBackdrop.addEventListener('click', (e)=> { if(e.target===orderTypeBackdrop) closeOrderType(); });

    // العودة للسلة
    backToCartBtn.addEventListener('click', ()=>{
      orderTypeBackdrop.style.display = 'none';
      cartBackdrop.style.display = 'flex';
      cartBackdrop.setAttribute('aria-hidden','false');
    });

    // إظهار/إخفاء قسم المدينة حسب اختيار نوع الطلب
    orderForm.orderType.forEach(r => {
      r.addEventListener('change', ()=> {
        const val = document.querySelector('input[name="orderType"]:checked').value;
        if(val === 'outside'){
          citySection.style.display = 'block';
        } else {
          citySection.style.display = 'none';
          // إزالة اختيار المدينة إن وجد
          const cityChecked = document.querySelector('input[name="city"]:checked');
          if(cityChecked) cityChecked.checked = false;
        }
        updateOrderTotal();
      });
    });

    // إذا اختيرت مدينة حدث إعادة حساب
    document.querySelectorAll('input[name="city"]').forEach(r=>{
      r.addEventListener('change', updateOrderTotal);
    });

    // حساب الإجمالي للعرض في مودال النوع
    function updateOrderTotal(){
      const subtotal = cart.reduce((s,i)=>s + (i.price * i.qty), 0);
      let delivery = 0;
      const orderType = document.querySelector('input[name="orderType"]:checked')?.value || 'inside';
      if(orderType === 'outside'){
        const city = document.querySelector('input[name="city"]:checked')?.value || 'other';
        if(city === 'tulkarm') delivery = 10;
        else if(city === 'nablus') delivery = 20;
        else delivery = 0;
      }
      const total = subtotal + delivery;
      orderTotalEl.textContent = `${total} ₪`;
      return {subtotal, delivery, total};
    }

    // ارسال الطلب عبر واتساب (بناء الرسالة)
    orderForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const note = orderNotes.value.trim();
      const {subtotal, delivery, total} = updateOrderTotal();

      const orderType = document.querySelector('input[name="orderType"]:checked')?.value || 'inside';
      let typeText = (orderType === 'inside') ? 'طلب داخل المطعم' : 'طلب توصيل (خارجي)';
      let cityText = '';
      if(orderType === 'outside'){
        const city = document.querySelector('input[name="city"]:checked')?.value || 'other';
        if(city === 'tulkarm') cityText = 'طولكرم';
        else if(city === 'nablus') cityText = 'نابلس';
        else cityText = 'أخرى';
      }

      // بناء رسالة واتساب بعناية (تفصيل الأصناف)
      let message = `مرحبًا، أود تقديم طلب من منيو جمار.%0A`;
      message += `نوع الطلب: ${typeText}.%0A`;
      if(cityText) message += `المدينة: ${cityText}.%0A`;
      message += `%0A--- تفاصيل الطلب ---%0A`;
      cart.forEach(ci => {
        const lineTotal = (ci.price * ci.qty);
        // ensure numeric calc step-by-step (small precaution)
        const qty = Number(ci.qty);
        const price = Number(ci.price);
        const calc = qty * price;
        message += `• ${ci.name} × ${qty} = ${calc} ₪%0A`;
      });
      if(delivery > 0) message += `%0Aتكلفة التوصيل: ${delivery} ₪%0A`;
      message += `%0Aالإجمالي: ${total} ₪%0A`;
      if(note) message += `%0Aملاحظات: ${encodeURIComponent(note)}%0A`;
      message += `%0Aشكراً لكم`;

      // افتح واتساب
      const waLink = BASE_WA_URL + message;
      window.open(waLink, '_blank');

      // بعد الإرسال: يمكنك اختيار تفريغ السلة أو إبقائها؛ هنا سأفرغها
      cart = [];
      renderCart();
      updateCartButton();
      closeOrderType();
    });

    // زر "اطلب الآن" العام (يفتح رسالة عامة)
    document.getElementById('orderNowTop').addEventListener('click', ()=>{
      window.open(makeWaLink('مرحبًا، أود الطلب من منيو جمار'), '_blank');
    });

    // زر QR
    document.getElementById('openQR').addEventListener('click', ()=>{
      const url = prompt('ضع رابط الصفحة/المنيو الذي تريد توليد QR له (مثال: https://example.com/menu)','https://example.com/your-menu');
      if(url) {
        document.getElementById('qrImg').src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(url);
        alert('تم توليد QR');
      }
    });

    // عرض جميع الأقسام عند التحميل - (Cards موجودة في الـ HTML وتستخدم openSection)
    // فقط تحديث نص زر السلة
    updateCartButton();

    // مساعدة: لو أردت إضافة قسم جديد برمجياً يمكنك تعديل الـ MENU أعلاه.
  </script>
</body>
</html>